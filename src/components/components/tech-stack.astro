---
import { getLangFromUrl, useTranslations } from "@i18n/utils";
import { Caslon } from "@atoms/text/caslon";
import AstroIcon from "@atoms/icons/astro-icon.astro";
import Bootstrap from "@atoms/icons/bootstrap.astro";
import Tailwindcss from "@atoms/icons/tailwindcss.astro";
import Nextjs from "@atoms/icons/nextjs.astro";
import Html5 from "@atoms/icons/html5.astro";
import Css from "@atoms/icons/css.astro";
import Javascript from "@atoms/icons/javascript.astro";
import Python from "@atoms/icons/python.astro";
import Mysql from "@atoms/icons/mysql.astro";
import Php from "@atoms/icons/php.astro";
import Laravel from "@atoms/icons/laravel.astro";
import React from "@atoms/icons/react.astro";
import { Poppins } from "@atoms/text/poppins";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Agrupamos las tecnologías por categorías
const frontendTechs = [
  { component: Html5, name: "HTML5" },
  { component: Css, name: "CSS" },
  { component: Javascript, name: "JavaScript" },
  { component: React, name: "React" },
  { component: Nextjs, name: "Next.js" },
];

const backendTechs = [
  { component: Python, name: "Python" },
  { component: Php, name: "PHP" },
  { component: Laravel, name: "Laravel" },
  { component: Mysql, name: "MySQL" },
];

const toolsTechs = [
  { component: AstroIcon, name: "Astro" },
  { component: Bootstrap, name: "Bootstrap" },
  { component: Tailwindcss, name: "Tailwind CSS" },
];
---

<div class="flex flex-col gap-8 md:gap-16 mb-24 scroll-mt-30" id="tech-stack">
  <Caslon
    text={t("techstack.title")}
    size="32|64"
    className="text-white mb-8 md:mb-12 self-center"
  />

  <!-- Carrusel 1: Frontend (se mueve a la derecha) -->
  <div class="flex flex-col gap-4">
    <Poppins
      text="Frontend"
      size="16|32"
      className="text-white text-xl md:text-2xl text-center"
      tag="h3"
    />
    <div class="splide splide-frontend w-full cursor-pointer">
      <div class="splide__track">
        <ul class="splide__list h-52! items-center!">
          {
            frontendTechs.map((tech) => (
              <li class="splide__slide h-[96px]! w-[100px]! md:w-[300px]! lg:w-[400px]! flex flex-col items-center gap-2 group relative">
                <tech.component className="w-full! h-full! max-h-[96px]! object-cover transition-transform duration-300 group-hover:scale-110" />
                <span class="absolute bottom-full mb-6 hidden group-hover:block border-white border-2 bg-white/10 backdrop-blur-sm text-white text-sm px-2 py-1 rounded whitespace-nowrap">
                  {tech.name}
                </span>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
  </div>

  <!-- Carrusel 2: Backend (se mueve a la izquierda) -->
  <div class="flex flex-col gap-4">
    <Poppins
      text="Backend"
      size="16|32"
      className="text-white text-xl md:text-2xl text-center"
      tag="h3"
    />
    <div class="splide splide-backend w-full cursor-pointer">
      <div class="splide__track">
        <ul class="splide__list h-52! items-center!">
          {
            backendTechs.map((tech) => (
              <li class="splide__slide h-[96px]! w-[100px]! md:w-[300px]! lg:w-[400px]! flex flex-col items-center gap-2 group relative">
                <tech.component className="w-full! h-full! max-h-[96px]! object-cover transition-transform duration-300 group-hover:scale-110" />
                <span class="absolute bottom-full mb-6 hidden group-hover:block border-white border-2 bg-white/10 backdrop-blur-sm text-white text-sm px-2 py-1 rounded whitespace-nowrap">
                  {tech.name}
                </span>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
  </div>

  <!-- Carrusel 3: Herramientas (se mueve más rápido y en zigzag) -->
  <div class="flex flex-col gap-4">
    <Poppins
      text={t("techstack.tools")}
      size="16|32"
      className="text-white text-xl md:text-2xl text-center"
      tag="h3"
    />
    <div class="splide splide-tools w-full cursor-pointer">
      <div class="splide__track">
        <ul class="splide__list h-52! items-center!">
          {
            toolsTechs.map((tech) => (
              <li class="splide__slide h-[96px]! w-[100px]! md:w-[300px]! lg:w-[400px]! flex flex-col items-center gap-2 group relative">
                <tech.component className="w-full! h-full! max-h-[96px]! object-cover transition-transform duration-300 group-hover:scale-110" />
                <span class="absolute bottom-full mb-6 hidden group-hover:block border-white border-2 bg-white/10 backdrop-blur-sm text-white text-sm px-2 py-1 rounded whitespace-nowrap">
                  {tech.name}
                </span>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
  import Splide from "@splidejs/splide";
  import { AutoScroll } from "@splidejs/splide-extension-auto-scroll";

  function initSplides() {
    // Carrusel Frontend - se mueve a la derecha (dirección ltr)
    const frontendSplide = new Splide('.splide-frontend', {
      type: 'loop',
      drag: 'free',
      focus: 'center',
      gap: '2rem',
      arrows: false,
      pagination: false,
      autoScroll: {
        speed: 0.1,
        pauseOnHover: false,
        pauseOnFocus: false,
      }
    });

    frontendSplide.mount({ AutoScroll });

    // Carrusel Backend - se mueve a la izquierda (dirección rtl)
    const backendSplide = new Splide('.splide-backend', {
      type: 'loop',
      drag: 'free',
      focus: 'center',
      direction: 'ltr',
      gap: '2rem',
      arrows: false,
      pagination: false,
      autoScroll: {
        speed: -1,
        pauseOnHover: false,
        pauseOnFocus: false,
      }
    });

    backendSplide.mount({ AutoScroll });

    // Carrusel Tools - se mueve más rápido
    const toolsSplide = new Splide('.splide-tools', {
      type: 'loop',
      drag: 'free',
      focus: 'center',
      gap: '2rem',
      arrows: false,
      pagination: false,
      autoScroll: {
        speed: 1,
        pauseOnHover: false,
        pauseOnFocus: false,
      }
    });

    toolsSplide.mount({ AutoScroll });
  }

  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSplides);
  } else {
    initSplides();
  }

  // Also run on Astro page transitions
  document.addEventListener('astro:page-load', initSplides);
</script>
